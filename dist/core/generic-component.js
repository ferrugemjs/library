define(["require","exports","incremental-dom"],function(t,e,s){"use strict";var a={},r=(new Date).getTime()+1298;s.notifications.nodesDeleted=function(t){t.forEach(function(t){var e=t.getAttribute?t.getAttribute("key-id"):"";e&&a[e]&&a[e].inst.detached&&a[e].inst.detached(),e&&a[e]&&(a[e].loaded=!1,a[e].inst=null,a[e]=null,delete a[e])})},s.notifications.nodesCreated=function(t){t.forEach(function(t){var e=t.getAttribute?t.getAttribute("key-id"):"";e&&a[e]&&(a[e].inst.attached&&!a[e].loaded&&a[e].inst.attached(),a[e].loaded=!0)})};var i=function(){function e(){}return e.prototype.build=function(t){var s=t.target;if(t.hostVars&&t.hostVars["key:id"]?(s=t.hostVars["key:id"],delete t.hostVars["key:id"]):t.staticVars&&t.staticVars["key:id"]&&(s=t.staticVars["key:id"],delete t.staticVars["key:id"]),t.hostVars&&t.hostVars["prop:values"]){var r=t.hostVars["prop:values"];delete t.hostVars["prop:values"];for(var i in r)t.hostVars[i]=r[i]}else t.staticVars&&t.staticVars["prop:values"]&&delete t.staticVars["prop:values"];if(t.classFactory.prototype.refresh||(t.classFactory.prototype.refresh=e.prototype.refresh),!t.classFactory.prototype.content,s&&a[s]){if(t.hostVars)for(var n in t.hostVars)n.indexOf(".")>-1&&delete t.hostVars[n];return this.changeAttrs.call(a[s].inst,t.hostVars),a[s].inst}return a[s]={inst:new t.classFactory},a[s].target=t.target,a[s].inst._$key$_=s,a[s].alias=t.alias,a[s].tag=t.tag||"div",a[s].tag=a[s].inst._$attrs$_?a[s].inst._$attrs$_.name:a[s].tag,this.changeAttrs.call(a[s].inst,t.hostVars),this.changeAttrs.call(a[s].inst,t.staticVars),a[s].inst._$attrs$_&&(a[s].extHostVars=a[s].inst._$attrs$_.dinamic,a[s].extStaticVars=Object.assign([],a[s].inst._$attrs$_["static"])),a[s].inst},e.prototype.content=function(t){return t?this._$content$_=t:this._$content$_&&this._$content$_(),this},e.prototype.changeAttrs=function(t,e){if(t)for(var s in t){var a=e&&("is"===s||"id"===s);if(!a){var r=s.toLowerCase().replace(/-(.)/g,function(t,e){return e.toUpperCase()}),i=t[s];if(r.indexOf(".")>-1){var n=r.split(".");this[n[0]][n[1]](i)}else{var o="set"+r.replace(/(^\D)/g,function(t,e){return t.toUpperCase()});this[o]?this[o](i):this[r]=i}}}},e.prototype.reDraw=function(){var t=a[this._$key$_]||{inst:this,extStaticVars:[],extHostVars:""};t.extHostVars=t.extHostVars||"",t.extStaticVars=t.extStaticVars||[],t.target=t.target||"uid_"+r++ +"_provided",t.extStaticVars.indexOf("id")<0?t.extStaticVars.push("id",t.target):t.target=t.extStaticVars[t.extStaticVars.indexOf("id")+1],t.extStaticVars.indexOf("is")<0&&t.alias&&t.extStaticVars.push("is",t.alias),t.inst._$key$_&&t.extStaticVars.push("key-id",t.inst._$key$_),s.elementOpen.apply(s,[t.tag,t.inst._$key$_,t.extStaticVars].concat(new Function("$_this_$","return ["+t.extHostVars+"]")(t.inst))),t.inst.render(t.inst),s.elementClose(t.tag)},e.prototype.refresh=function(t){var r=a[this._$key$_]||{inst:this};if(t&&e.prototype.changeAttrs.apply(r.inst,[t]),(r.loaded||"compose-view"==r.alias)&&r.target&&document.getElementById(r.target)){var i=document.getElementById(r.target);if(r.extHostVars&&'""'!==r.extHostVars){var n=new Function("$_this_$","return ["+r.extHostVars+"]")(r.inst);n.forEach(function(t,e){var s=e||2;s%2===0&&i.setAttribute(t,n[e+1])})}s.patch(i,r.inst.render,r.inst)}},e.prototype.compose=function(s,r,i,n,o){var c=this;t([s+".html"],function(t){var s=c.build({classFactory:t["default"],hostVars:i,staticVars:n,target:r,alias:"compose-view",tag:"div"});e.prototype.content.call(a[s._$key$_],o),s.refresh(),s.attached&&!a[s._$key$_].loaded&&s.attached(),a[s._$key$_].loaded=!0})},e}();e.FerrugemJSFactory=i,Object.defineProperty(e,"__esModule",{value:!0}),e["default"]=new i});