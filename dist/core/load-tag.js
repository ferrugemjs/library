define(["require","exports","incremental-dom","./register-tag"],function(e,t,o,r){"use strict";var n=function(){function e(){}return e.prototype.refresh=function(){this._$el$domref&&o.patch(document.getElementById(this._$el$domref),function(){this._$render_from_powerup(this,r["default"],s)}.bind(this))},e}(),i=function(){function e(){this.moduleWait=[]}return e.prototype.resolveModules=function(){var e=this;this.moduleWait.forEach(function(t){e.initModule(t)})},e.prototype.initModule=function(e){var t=r["default"].getRegistred(e.tag),o=new t._$controller;o._$el$domref=e.target,o.refresh(),o.attached&&o.attached(),this.changeProps(o,e.host_vars)},e.prototype.load=function(e,t,i,s,u){var a=r["default"].getRegistred(e),l="custom_element_id_"+(new Date).getTime();o.elementOpen("div",l,["id",l]),o.elementClose("div"),s&&(i||(i=[]),i.push(s),i.push(u));var d={tag:a.tag,target:l,host_vars:i};if(a&&a._$controller)d.loaded=!0,this.moduleWait.push(d);else if(this.moduleWait.push(d),!a.loading){var p=this;r["default"].setLoading(a.tag),System["import"](a.url).then(function(e){var t=Object.keys(e)[0];r["default"].config(a.tag,e[t]),System["import"](a.url+".html").then(function(o){var r=Object.keys(o)[0];e[t].prototype.refresh||(e[t].prototype.content=function(){},e[t].prototype._$render_from_powerup=o[r],e[t].prototype.refresh=n.prototype.refresh),p.resolveModules()})})}return this},e.prototype.content=function(e){var t=this.moduleWait.length-1;this.moduleWait[t].loaded&&this.initModule(this.moduleWait.pop())},e.prototype.changeProps=function(e,t){if(t&&t.length>0)for(var o=t.length,r=0;r<o/2;++r){var n=t[r],i=t[r+1],s="set"+n.replace(/(^\D)/g,function(e,t){return e.toUpperCase()});e[s]?e[s](i):e[n]=i}},e}(),s=new i;Object.defineProperty(t,"__esModule",{value:!0}),t["default"]=s});