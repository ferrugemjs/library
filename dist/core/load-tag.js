define(["require","exports","incremental-dom","./register-tag"],function(t,e,o,r){"use strict";var n=function(){function t(){}return t.prototype.refresh=function(){this._$el$domref&&o.patch(document.getElementById(this._$el$domref),function(){this._$render_from_powerup(this,r["default"],a)}.bind(this))},t}(),i=function(){function t(){this.moduleWait=[]}return t.prototype.resolveModules=function(){var t=this;this.moduleWait.forEach(function(e){t.initModule(e)})},t.prototype.initModule=function(t){var e=r["default"].getRegistred(t.tag),o=new e._$controller;o._$el$domref=t.target,o.refresh(),o.attached&&o.attached(),this.changeProps(o,t.host_vars)},t.prototype.load=function(t,e,i){for(var a=[],u=3;u<arguments.length;u++)a[u-3]=arguments[u];var s=r["default"].getRegistred(t),l="custom_element_id_"+(new Date).getTime();o.elementOpen("div",l,["id",l]),o.elementClose("div"),a&&(i||(i=[]),a.forEach(function(t){i.push(t)}));var d={tag:s.tag,target:l,host_vars:i};if(s&&s._$controller)d.loaded=!0,this.moduleWait.push(d);else if(this.moduleWait.push(d),!s.loading){var f=this;r["default"].setLoading(s.tag),System["import"](s.url).then(function(t){var e=Object.keys(t)[0];r["default"].config(s.tag,t[e]),System["import"](s.url+".html").then(function(o){var r=Object.keys(o)[0];t[e].prototype.refresh||(t[e].prototype.content=function(){},t[e].prototype._$render_from_powerup=o[r],t[e].prototype.refresh=n.prototype.refresh),f.resolveModules()})})}return this},t.prototype.content=function(t){var e=this.moduleWait.length-1;this.moduleWait[e].loaded&&this.initModule(this.moduleWait.pop())},t.prototype.changeProps=function(t,e){if(e&&e.length>1)for(var o=e.length,r=0;r<o;r+=2){var n=e[r],i=e[r+1],a="set"+n.replace(/(^\D)/g,function(t,e){return t.toUpperCase()});t[a]?t[a](i):t[n]=i}},t}(),a=new i;Object.defineProperty(e,"__esModule",{value:!0}),e["default"]=a});