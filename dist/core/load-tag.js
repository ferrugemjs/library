define(["require","exports","incremental-dom","./register-tag"],function(e,t,o,r){"use strict";var n=function(){function e(){this.moduleWait=[]}return e.prototype.resolveModules=function(){var e=this;this.moduleWait.forEach(function(t){e.initModule(t)})},e.prototype.initModule=function(e){var t=r["default"].getRegistred(e.tag),o=new t._$controller;o._$el$domref=e.target,o.refresh(),o.attached&&o.attached(),this.changeProps(o,e.host_vars)},e.prototype.load=function(e,t,n,i,a){var s=r["default"].getRegistred(e),u="custom_element_id_"+(new Date).getTime();o.elementOpen("div",u,["id",u]),o.elementClose("div"),i&&(n||(n=[]),n.push(i),n.push(a));var l={tag:s.tag,target:u,host_vars:n};if(s&&s._$controller)l.loaded=!0,this.moduleWait.push(l);else if(this.moduleWait.push(l),!s.loading){var d=this;r["default"].setLoading(s.tag),System["import"](s.url).then(function(e){var t=Object.keys(e)[0];r["default"].config(s.tag,e[t]),System["import"](s.url+".html").then(function(n){var i=Object.keys(n)[0];e[t].prototype.refresh||(e[t].prototype.content=function(){},e[t].prototype._$render_from_powerup=n[i],e[t].prototype.refresh=function(){this._$el$domref&&o.patch(document.getElementById(this._$el$domref),function(){this._$render_from_powerup(this,r["default"],d)}.bind(this))}),d.resolveModules()})})}return this},e.prototype.content=function(e){var t=this.moduleWait.length-1;this.moduleWait[t].loaded&&this.initModule(this.moduleWait.pop())},e.prototype.changeProps=function(e,t){if(t&&t.length>0)for(var o=t.length,r=0;r<o/2;++r){var n=t[r],i=t[r+1],a="on"+n.replace(/(^\D)/g,function(e,t){return e.toUpperCase()})+"Changed",s=e[n];e[n]=i,e[a]&&e[a](i,s)}},e}();Object.defineProperty(t,"__esModule",{value:!0}),t["default"]=new n});